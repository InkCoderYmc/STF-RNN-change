# STF-RNN: Space Time Features-based Recurrent Neural Network for PredictingPeople Next Location



### Abstract

本文提出了一种新型的基于空间时间特征的循环神经网络STF-RNN模型，根据从CPS设备日志中获取的移动估计来预测人的下一次移动。在模型的操作中，主要涉及两个特征，即从收集的GPS数据中提取的空间和从相关的时间戳中提取的时间。

在所提出的模型中，空间和事件特征的内部表征是自动提取的，而不是依赖手工制作的表征。这使得该模型能够更有效地发现关于人的行为的有用知识。由于RNN结构具有表示序列的能力，因此在所提出的模型中被利用，以保持对用户运动历史的跟踪。这些跟踪有助于模型发现更多有意义的依赖关系，从而提高了模型的性能。研究结果表明，与最先进的模型相比，STF-RNN在预测人们的下一个位置方面有很好的改进，在Geo-life项目的数据集上应用。



### Introduction

人类行为非常复杂多样，作为人类行为的组成部分，移动性也很复杂，但是其可变性较低，可以使用更加集中的模式识别犯法进行研究。

大多数情况下，分析人的流动性的目的是预测未来的行为，流动性预测的定义是对人们在其不断移动的区域中下一个位置的预测。

由于平板电脑、智能手机、智能手表等移动设备的广泛普及，以及其数据收集能力的迅速增强，我们可以以非常低的成本手机大量的人员出行数据。大量收集数据的可用性以及基于位置的应用程序和服务的开发，引起了学术界和工业界的特别关注，他们致力于构建用于分析和预测用户下一个运动或位置的有效方法。这些方法旨在改善终端用户的应用，如医疗保健应用、推荐系统、路线规划、拼车、会议规划或基于位置的广告等。

还旨在帮助相应机构解决与网络管理、医疗保健、人机交互、城市规划的社会经济模型、公共交通规划、公共安全保证等相关的问题。



为了预测人们的未来位置，应采用诸如马尔科夫模型、关联规则、贝叶斯网络或神经网络之类的学习技术。研究人员在预测人们运动时面临的挑战之一是如何转移（适应）这些技术以与运动的背景信息一起工作。

而且，为所有用户建立准确的预测模型并不是一件容易的事情，有时可能会因为下一个位置预测对一个用户特定的问题，所以不可实现。即使不同用户之间的访问地点可能会有重叠，但用户访问不同地点的轨迹很可能是唯一的。因为，为每个用户建立一个预测模型可能是比较好的，通常情况下，模型的建立（即发现经常出现的轨迹和位置）是在离线状态下进行的，而预测本身是在线进行的。



如今，对人们的下一个位置的预测已经得到了广泛的研究。马尔科夫链模型，通过计算移动数据记录中的转移概率来推断用户的下一个位置。类似的，有采用隐马尔科夫模型来预测出现目的地，并考虑到位置特征或用户活动转变作为不可观察的参数。一种基于规则的方法，可以从移动交易数据库中发现关联。作为另一种流行的方法， 神经网络已经被应用于蜂窝通信网络中的位置预测问题，以通过自动更新移动用户的位置信息来减少流量负担。



最近，RNN已经在许多领域成功使用，例如顺序点击预测、词嵌入、和时间序列预测。再近期，一些研究利用RNN来模拟人的流动性，作者报告说，与传统神经网络模型相比，RNN取得了令人鼓舞的性能。



一般来说，根据用户日常的可预测性可以将用户分为三种不同类型：可预测用户（predictable users）、预期用户（expected users）和随机用户（random users）。

预测用户在工作期间遵循住所和工作场所之间的常规历程。对于这类用户，很容易准确的预测其下一个位置。后两中类型的特征是高度复杂的运动，通常具有大量的访问位置，因此难以准确地预测他们的下一个位置。为了为这些用户建立有效的预测方法，必须使用更复杂的方法研究其移动性数据。



一些研究集中于使用一组特征来获得看良好的预测性能。例如，使用各种手工制作的功能。这样的模型缺乏从人们的移动数据中捕获语义信息的能力，为了克服此缺点，已使用深度学习模型来自动学习空间和时间特征的最佳内部表示形式。



本文中，我们建议利用RNN对人们的移动行为进行建模，以预测他们的下一个位置。空间和时间包含在网络中作为特征，内部表示是通过网络本身来学习的，而不是依赖于人为代表。空间表示用户访问过的特定位置，时间表示访问时间。

建立预测模型之前，将收集的GPS点转换为代表用户访问的一系列位置的兴趣点序列。训练过程中，可训练输入要素将先前积累的隐藏状态一起前馈到隐藏层中。

对Geo-life数据集的实验表明，与最新模型相比，这种RNN结构将增强模型的有效性。



本文贡献：

1、使用查找表层来发现足够的空间和时间输入特征的内部表示，同时避免人为的表示。

2、使用RNN来构建人的运动，并成功地将具有时间和空间特征的递归结构融入到提高模型效率中。

3、在大型现实生活中的流动性数据集进行了广泛的实验，以评估所开发模型的效率。



实验表明，就召回率而言，比最新的模型高出26%。



### 最先进的技术

总结在轨迹预测中提出的不同类型的模型，包括MC、神经网络和RNN，重点介绍了所使用的数据集和分析预测技术。

STRNN提出了一个称为时空递归神经网络的全局预测模型，用于预测用户下一步将去哪里。RNN不仅用于不会哦本地时态上下文，还用于捕获周期性时域上下文。为了产生时间特定和距离特定的转换矩阵，将空间和时间值划分为离散值。对一个时间段内的内一个特定的时间值和每一个特定的空间值都计算出相应的转换矩阵。

与ST-RNN不同，本文的模型，空间和时间特征被直接反馈到网络中，而网络自身负责学习它们的内部表示。



建立局部和全局预测器以基于神经网络预测每个人的下一个运动。使用最简单的多层感知器，并通过反向传播算法训练了一个隐藏层。位编码用来表示房间和人。在局部预测器下，每个神经网络都是通过一个人的轨迹来训练。因此，只有最后访问的房间的代码才是网络的输出。在全局预测器下，一个神经网络对所有人的轨迹进行了训练。

神经网络的最佳配置为，输入层和隐藏层分别使用两个和三个神经元。

结果：局部预测器以92.32%和87.3%的准确性分别由于全局预测器。



n-马尔科夫链概念，跟踪n个访问过的位置，以预测用户的下一个位置。使用了三种不同的数据集：Phonetic、Geolife、synthetic。

密度联合聚类算法（Density-Joinable clustering）用于发现下一个POI。

n-MMC是基于发现的POI之间的转移概率构建的。基于位置之间的高频移动，检索下一个位置。

n=2时，Geolife数据集的最佳模型性能达到了69%。



### Methodology

数据预处理步骤、STF-RNN的描述。

#### 1、数据预处理

数据预处理是一种将原始数据转换为适当格式以进一步处理。

通过检测兴趣点，将GPS日志转换为轨迹。兴趣点表示用户停留超过预定阈值的空间区域，条件是该区域的起点和终点之间的距离在特定阈值以下。

这些兴趣点将使用基于噪声的应用程序基于密度的空间聚类聚集成几个地理空间区域。最后，使用这些聚类的兴趣点来定制每个用户的位置历史记录。

#### 2、模型描述

轨迹表示为一个元组序列$(x_t, h_t)$，其中$x$是在时间$t$时访问的兴趣点的中心点ID，$h$是从兴趣点离开的时间，以小时为单位，$t = 1, 2, \dots, n$，$n$是轨迹的长度。

任务是根据其历史移动记录来预测移动用户在特定时间的未来位置。

![image-20200528144223109](G:\读书学习笔记\STFRNN.png)

由四层组成：输入层、查找表层、隐藏层和输出层。



输入层由两个向量组成。

第一个向量是$x_t \in \R^N$，表示$t$时间兴趣点的中心ID，这个向量使用1-of-N进行编码（也就是one-hot），N表示兴趣点的数量

第二个向量表示$t$时间时离开兴趣点的小时数。表示为$h_t \in \R^M$，使用1-of-N进行编码，M表示不同时间间隔的数量。

one-hot向量中，兴趣点或离开时间彼此等距，但不保留它们之间的任何关系。



查找表层将中心ID的向量和离开时间映射为实值向量。目的是学习兴趣点和离开时间的输入特征中的有效表示。这种表示方式使模型能够捕捉到用户行为的语义信息，从而提高了预测性能。因此，可训练特征将用作网络中其他层的输入，而不是使用one-hot矢量。

更正式的描述，

令$X \in \R^{N \times d}$表示一组兴趣点的嵌入矩阵，其中$d$为兴趣点的嵌入向量的维度。

嵌入向量$xe_t \in \R^d$由嵌入矩阵$X$和输入向量$x_t$相乘得到：$xe_t = x_tX$。

同理，嵌入向量$he_t \in \R^k$由嵌入矩阵$H \in \R^{M \times k}$和输入向量$h_t$相乘得到：$he_t = h_tH$，$H$表示离开时间集合，$k$表示离开时间向量的维数。



隐藏层$r_t \in \R^{d_r}$的目的是维护用户的运动历史，其中$d_r$是隐藏层向量的维数。

输出层$\hat{y_t} \in \R^{d_r}$在兴趣点上产生一个概率分布，具有与输入向量$x_t$相同的维数。
$$
r_t = f(xe_tU + he_tS + r_{t-1}W + b_r)\\
\hat{y} = g(r_tV + b)
$$
$U \in \R^{d \times d_r}$，$S \in \R^{k \times d_r}$是输入层和隐藏层之间的权重矩阵，$W \in \R^{d_r \times d_r}$是循环连接传播序列信号，$b_r \in \R^{d_r}$是隐藏层的偏置。

$V \in \R^{d_r \times N}$表示隐藏层和输出层之间的权重矩阵，$b \in \R^N$是输出层的偏置。

$\tanh$用作隐藏层的非线性激活函数。$softmax$函数作用在输出层上。
$$
f(x)=\frac{1-e^{-2x}}{1+e^{-2x}}\\
g(x_i)=\frac{e^{x_i}}{\sum_je^{x_j}}
$$
当前的输入层以及隐藏层的上一个状态用于计算隐藏层的下一个状态。因此，下一个位置预测不仅取决于当前的输入位置，而且还取决于顺序的历史信息。RNN结构的这个属性有助于模型跟踪用户的移动历史并发现有意义的依存关系，从而提高模型的性能。

#### 3、学习算法

使用反向传播算法BPTT。

隐藏层的下一个状态是根据当前输入层以及隐藏层的前一个状态计算的。

这项工作中使用的损失函数是交叉熵：

$$
J = - \sum^n_{i=1}y_i\log(\hat{y_i})
$$
$n$是训练样本数，$y$是用户的下一个真实区域，$\hat{y}$是预测的下一个区域的概率。



因为已经使用了one-hot向量表示兴趣点的中心ID，所以损失函数可以重新定义为:
$$
J = -\log(\hat{y_i})
$$
AdaDelta用来估计模型参数，$\theta = [X, H, U, S, W, V, b_r, b, r_0]$，其中$r_0$是循环层的初始向量。



### 实验和结果

